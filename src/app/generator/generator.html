yy
 
<div class="generator-page">
 
  <div *ngIf="notification" 
       class="notification-banner"
       [class]="notification.type"
       (click)="dismissNotification()">
    <div class="notification-content">
      <span class="notification-icon">
        {{ notification.type === 'error' ? 'âŒ' : 
           notification.type === 'warning' ? 'âš ï¸' : 'âœ…' }}
      </span>
      <span class="notification-message">{{ notification.message }}</span>
    </div>
    <button class="notification-close" (click)="dismissNotification()">Ã—</button>
  </div>

  <div class="generator-container">
   
    <div class="generator-header">
      <div class="header-left">
        <h1>{{ translationService.translate('title') }}</h1>
        <p>{{ translationService.translate('subtitle') }}</p>
      </div>
      
      <div class="header-right">
        <div class="user-info">
      
          <button class="language-switch" (click)="toggleLanguage()">
            {{ currentLang === 'it' ? 'ğŸ‡®ğŸ‡¹' : 'ğŸ‡ºğŸ‡¸' }}
            {{ currentLang === 'it' ? 'IT' : 'EN' }}
          </button>
          
          <button class="archive-btn" (click)="openArchive()">
            <div class="archive-btn-content">
              <span class="archive-icon">ğŸ“</span>
              <span class="archive-text">{{ translationService.translate('archive') }}</span>
            </div>
          </button>
          
          <button *ngIf="user" class="credit-balance" (click)="openCreditStore()">
            <div class="credits-display">
              <span class="credits-icon">ğŸª™</span>
              <span class="credits-count">{{ user?.credits }} {{ translationService.translate('credits') }}</span>
              <span class="plan-badge">{{ user?.plan || 'Free' }}</span>
            </div>
          </button>
          
          <button class="logout-btn" (click)="logout()">
            <span class="btn-icon">ğŸ‘‹</span>
            {{ translationService.translate('logout') }}
          </button>
        </div>
      </div>
    </div>

   
    <div class="dashboard-container">
      <div class="dashboard">
        <div class="generate-card">
          <h3>{{ translationService.translate('generateContent') }}</h3>
          
         <!-- <button class="assistant-btn" (click)="openContentAssistant(this.contentToOptimize)">
  <span class="assistant-icon">ğŸ¤–</span>
  <span class="assistant-text">Content Assistant</span>
  <span class="assistant-badge">NEW</span>
</button> -->

      
          <div class="mode-selector">
            <button class="mode-btn" 
                    [class.active]="inputMode === 'manual'"
                    (click)="switchToManualMode()">
              {{ translationService.translate('manual') }}
            </button>
            <button class="mode-btn" 
                    [class.active]="inputMode === 'guided'"
                    (click)="switchToGuidedMode()">
              {{ translationService.translate('guided') }}
            </button>
          </div>
          
     
          <div *ngIf="inputMode === 'manual'" class="manual-section">
            <textarea [(ngModel)]="inputText" 
                      [placeholder]="translationService.translate('manualPlaceholder')" 
                      rows="12"></textarea>
            <div *ngIf="showManualWarning" class="field-warning">
              âš ï¸ {{ currentLang === 'it' ? 'Inserisci almeno 10 caratteri di descrizione' : 'Enter at least 10 characters of description' }}
            </div>
          </div>
          
       
          <div *ngIf="inputMode === 'guided'" class="guided-section">
          
            <div class="guided-field">
              <label>{{ currentLang === 'it' ? 'ğŸ·ï¸ Argomento Principale *' : 'ğŸ·ï¸ Main Topic *' }}</label>
              <select [(ngModel)]="guidedInput.topic" [class.error]="showTopicError" >
                <option value="">{{ currentLang === 'it' ? 'Seleziona un argomento (obbligatorio)' : 'Select a topic (required)' }}</option>
                <option value="food">{{ currentLang === 'it' ? 'ğŸ• Cibo & Ricette' : 'ğŸ• Food & Recipes' }}</option>
                <option value="fitness">{{ currentLang === 'it' ? 'ğŸ’ª Fitness & Salute' : 'ğŸ’ª Fitness & Health' }}</option>
                <option value="tech">{{ currentLang === 'it' ? 'ğŸ’» Tecnologia' : 'ğŸ’» Technology' }}</option>
                <option value="fashion">{{ currentLang === 'it' ? 'ğŸ‘— Moda & Beauty' : 'ğŸ‘— Fashion & Beauty' }}</option>
                <option value="business">{{ currentLang === 'it' ? 'ğŸ’¼ Business & Startup' : 'ğŸ’¼ Business & Startup' }}</option>
                <option value="travel">{{ currentLang === 'it' ? 'âœˆï¸ Viaggi & Avventura' : 'âœˆï¸ Travel & Adventure' }}</option>
                <option value="lifestyle">{{ currentLang === 'it' ? 'ğŸ¡ Lifestyle' : 'ğŸ¡ Lifestyle' }}</option>
                <option value="education">{{ currentLang === 'it' ? 'ğŸ“ Educazione' : 'ğŸ“ Education' }}</option>
                <option value="entertainment">{{ currentLang === 'it' ? 'ğŸ¬ Intrattenimento' : 'ğŸ¬ Entertainment' }}</option>
                <option value="sports">{{ currentLang === 'it' ? 'âš½ Sport' : 'âš½ Sports' }}</option>
                <option value="finance">{{ currentLang === 'it' ? 'ğŸ’° Finanza Personale' : 'ğŸ’° Personal Finance' }}</option>
              </select>
              <div *ngIf="showTopicError" class="field-error">
                âš ï¸ {{ currentLang === 'it' ? 'Seleziona un argomento' : 'Select a topic' }}
              </div>
            </div>

        
            <div class="guided-field">
              <label>{{ currentLang === 'it' ? 'ğŸ¯ Obiettivo del Post *' : 'ğŸ¯ Post Goal *' }}</label>
              <select [(ngModel)]="guidedInput.goal" [class.error]="showGoalError" >
                <option value="">{{ currentLang === 'it' ? 'Seleziona un obiettivo (obbligatorio)' : 'Select a goal (required)' }}</option>
                <option value="awareness">{{ currentLang === 'it' ? 'ğŸ‘€ Aumentare visibilitÃ ' : 'ğŸ‘€ Increase visibility' }}</option>
                <option value="engagement">{{ currentLang === 'it' ? 'ğŸ’¬ Generare like/commenti' : 'ğŸ’¬ Generate likes/comments' }}</option>
                <option value="conversion">{{ currentLang === 'it' ? 'ğŸ›’ Vendere prodotti/servizi' : 'ğŸ›’ Sell products/services' }}</option>
                <option value="leads">{{ currentLang === 'it' ? 'ğŸ“© Raccolta contatti' : 'ğŸ“© Collect contacts' }}</option>
                <option value="community">{{ currentLang === 'it' ? 'ğŸ‘¥ Costruire community' : 'ğŸ‘¥ Build community' }}</option>
                <option value="traffic">{{ currentLang === 'it' ? 'ğŸŒ Portare traffico al sito' : 'ğŸŒ Drive website traffic' }}</option>
              </select>
              <div *ngIf="showGoalError" class="field-error">
                âš ï¸ {{ currentLang === 'it' ? 'Seleziona un obiettivo' : 'Select a goal' }}
              </div>
            </div>

      
            <div class="guided-field">
              <label>{{ currentLang === 'it' ? 'ğŸ’¡ Dettagli specifici (opzionale)' : 'ğŸ’¡ Specific details (optional)' }}</label>
              <textarea [(ngModel)]="guidedInput.keyMessage" 
                        [placeholder]="currentLang === 'it' ? 'Qualche dettaglio in piÃ¹? Es: Nuovo prodotto X, Offerta speciale, Evento del weekend...' : 'Any specific details? Ex: New product X, Special offer, Weekend event...'"
                        rows="2"></textarea>
            </div>
            
       
            <div *ngIf="generatedPrompt" class="preview-section">
              <h4>{{ currentLang === 'it' ? 'ğŸ“‹ Questo Ã¨ ciÃ² che verrÃ  generato:' : 'ğŸ“‹ This is what will be generated:' }}</h4>
              <div class="preview-box">
                {{ generatedPrompt }}
              </div>
            </div>
          </div>

      
          <div class="brand-section">
            <button class="brand-manager-btn" 
                    [class.error]="showBrandError"
                    (click)="openBrandModal()">
              {{ translationService.translate('selectBrand') }}
              <span class="brand-counter" *ngIf="maxBrands > 0">
                ({{ currentBrands }}/{{ maxBrands }})
              </span>
            </button>
            <div *ngIf="selectedBrand" class="selected-brand">
              <strong>{{ translationService.translate('brandSelected') }}</strong> {{ selectedBrand!.brandName! }}
              <span class="brand-tone">({{ selectedBrand!.tone! }})</span>
            </div>

          
            <div *ngIf="!canCreateMoreBrands" class="limit-warning">
              âš ï¸ {{ currentLang === 'it' ? 'Limite brand raggiunto! Upgrade per crearne di piÃ¹.' : 'Brand limit reached! Upgrade to create more.' }}
            </div>
            <div *ngIf="showBrandError" class="field-error">
              âš ï¸ {{ currentLang === 'it' ? 'Seleziona un brand prima di generare' : 'Select a brand before generating' }}
            </div>
          </div>

         
          <div class="platform-selector">
            <label>{{ translationService.translate('platform') }}</label>
            <div class="custom-dropdown" [class.open]="dropdownOpen">
              <div class="dropdown-trigger" (click)="dropdownOpen = !dropdownOpen">
                <div class="selected-option">
                  <mat-icon class="social-icon" [class]="platform">{{ getPlatformIcon(platform) }}</mat-icon>
                  <span class="platform-name">{{ getPlatformName(platform) }}</span>
                  <mat-icon class="dropdown-arrow">â–¼</mat-icon>
                </div>
              </div>
              <div class="dropdown-menu" *ngIf="dropdownOpen">
                <div class="dropdown-option" 
                     *ngFor="let platformOption of platformOptions" 
                     (click)="selectPlatform(platformOption.value)"
                     [class.selected]="platform === platformOption.value">
                  <mat-icon class="social-icon" [class]="platformOption.value">{{ platformOption.icon }}</mat-icon>
                  <span class="platform-name">{{ platformOption.name }}</span>
                </div>
              </div>
            </div>
          </div>

          <!-- <label>{{ translationService.translate('postType') }}</label> -->
          
          <div class="controls">
          
            <select id="postType" [(ngModel)]="selectedPostType">
               <option *ngFor="let type of postTypeOptions" [value]="type.value">
     {{ type.display }}
    </option>
   </select>
          </div>

       
          <div class="histogram-container">
            <h4>{{ translationService.translate('controlBars') }}</h4>
            <div class="bars-wrapper">
              <div 
                *ngFor="let point of colorPoints"
                class="bar-item"
                (mousedown)="startDrag(point, $event)"
                (mousemove)="onDrag($event)"
                (mouseup)="stopDrag()"
                (mouseleave)="stopDrag()"
                (touchstart)="startTouch(point, $event)"
                (touchmove)="onTouchMove($event)"
                (touchend)="stopDrag()"
              >
                <div class="bar" [style.height.%]="point.value" [style.background]="point.color"></div>
              </div>
            </div>
          </div>

       
          <div class="parameters-preview">
            <div *ngFor="let point of colorPoints" class="param-item">
              <div class="param-color" [style.background]="point.color"></div>
              <span class="param-name">{{ getTranslatedParamName(point) }}:</span>
              <span class="param-value">{{ point.value }}%</span>
            </div>
          </div>

       
          <div class="generate-section">
            <button (click)="generate()" 
                    [disabled]="isGenerating || generationStatus === 'queued'">
              {{ isGenerating ? translationService.translate('generating') : translationService.translate('generateButton') }}
            </button>
          </div>

         <div *ngIf="output" class="image-generation-section">
  <h3>ğŸ¨ Genera Immagini</h3>
  
  <button class="btn-generate-images" 
          (click)="prepareImageGeneration()"
          [disabled]="!output?.socialPostVersions?.length">
    ğŸ–¼ï¸ Genera Immagini dai Post
  </button>
  <div class="image-tip">
    <small>Puoi generare immagini per tutti i post o selezionarne uno specifico</small>
  </div>
</div>

<div class="modal images-modal" *ngIf="imagesModalOpen" (click)="closeImagesModal()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeImagesModal()">Ã—</button>
    
    <h2>ğŸ¨ Genera Immagini</h2>
    
    <!-- Se ci sono giÃ  immagini generate, mostrale -->
    <div *ngIf="generatedImages.length > 0" class="generated-images-container">
      <h3>Immagini Generate</h3>
      <div class="images-grid">
        <div *ngFor="let image of generatedImages" class="image-card">
          <img [src]="image.imageUrl" [alt]="'Immagine per ' + platform">
          <div class="image-info">
            <p><strong>Piattaforma:</strong> {{ getPlatformName(image.platform) }}</p>
            <p><strong>Dimensioni:</strong> {{ image.dimensions.width }}Ã—{{ image.dimensions.height }}</p>
          </div>
          <div class="image-actions">
            <button class="btn-copy" (click)="copyImageUrl(image.imageUrl)">
              ğŸ“‹ Copia URL
            </button>
            <button class="btn-download" (click)="downloadImage(image.imageUrl, selectedBrand?.brandName)">
              ğŸ’¾ Download
            </button>
          </div>
        </div>
      </div>
      
      <button class="btn-outline" (click)="closeImagesModal()">
        Chiudi
      </button>
    </div>
    
    <!-- Se non ci sono immagini ancora, mostra la selezione dei post -->
    <div *ngIf="generatedImages.length === 0" class="image-selection-container">
      <h3>Seleziona i Post per Generare Immagini</h3>
      
      <!-- ModalitÃ  di selezione -->
      <div class="selection-mode">
        <button class="mode-btn" 
                [class.active]="imageSelectionMode === 'all'"
                (click)="selectAllPosts()">
          ğŸ“‘ Tutti e 3 i Post
        </button>
        <button class="mode-btn" 
                [class.active]="imageSelectionMode === 'single'"
                (click)="selectedPostsForImages = []; imageSelectionMode = 'single'">
          ğŸ¯ Solo un Post
        </button>
      </div>
      
      <!-- Lista dei post disponibili -->
      <div class="posts-list">
        <div *ngFor="let post of availablePosts" 
             class="post-item"
             [class.selected]="selectedPostsForImages.includes(post.content)">
          
          <div class="post-checkbox" *ngIf="imageSelectionMode !== 'single'">
            <input type="checkbox" 
                   [checked]="selectedPostsForImages.includes(post.content)"
                   (change)="togglePostSelection(post.content)">
          </div>
          
          <div class="post-content-preview" 
               [class.single-selection]="imageSelectionMode === 'single'"
               (click)="imageSelectionMode === 'single' ? selectSinglePost(post.content) : null">
            
            <div class="post-source">
              <strong>{{ post.source }}</strong>
            </div>
            
            <div class="post-text">
              {{ post.content }}
            </div>
            
            <div *ngIf="imageSelectionMode === 'single'" class="single-selection-indicator">
              {{ selectedPostForImage === post.content ? 'âœ…' : 'â¬œ' }}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Contatore selezione -->
      <div class="selection-counter">
        <strong>{{ selectedPostsForImages.length }}</strong> post selezionati
        <span *ngIf="selectedPostsForImages.length > 0">
          ({{ selectedPostsForImages.length }} immagine{{ selectedPostsForImages.length > 1 ? 'i' : '' }} saranno generate)
        </span>
      </div>
      
      <!-- Azioni -->
      <div class="modal-acts">
        <button class="btn-outline" (click)="closeImagesModal()">
          Annulla
        </button>
        
        <button class="btn-primary-images" 
                (click)="generateImages()"
                [disabled]="selectedPostsForImages.length === 0 || generatingImages">
          
          <span *ngIf="!generatingImages">
            ğŸš€ Genera {{ selectedPostsForImages.length }} Immagine{{ selectedPostsForImages.length > 1 ? 'i' : '' }}
          </span>
          
          <span *ngIf="generatingImages" class="generating-state">
            <div class="spinner-small"></div>
            Generazione in corso...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 3. Sezione per mostrare immagini generate (inline sotto i post) -->
<div *ngIf="generatedImages.length > 0 && !imagesModalOpen" class="inline-images-section">
  <h3>ğŸ¨ Immagini Generate</h3>
  
  <div class="images-preview-grid">
    <div *ngFor="let image of generatedImages" class="image-preview-card">
      <div class="image-container">
        <img [src]="image.imageUrl" 
             [alt]="'Immagine social per ' + selectedBrand?.brandName"
             class="preview-image">
      </div>
      
      <div class="image-actions-inline">
        <button class="btn-small" (click)="copyImageUrl(image.imageUrl)">
          ğŸ“‹
        </button>
        <button class="btn-small" (click)="downloadImage(image.imageUrl)">
          ğŸ’¾
        </button>
        <button class="btn-small" (click)="imagesModalOpen = true">
          ğŸ”
        </button>
      </div>
    </div>
  </div>
</div>
  </div>
</div>

       
          <div *ngIf="generationStatus === 'queued'" class="queue-status">
            <div class="queue-info">
              <div class="spinner"></div>
              <h3>â³ {{ currentLang === 'it' ? 'In coda di elaborazione' : 'In processing queue' }}</h3>
              <p>{{ currentLang === 'it' ? 'Posizione' : 'Position' }}: <strong>#{{ queuePosition }}</strong></p>
              <p>{{ currentLang === 'it' ? 'Tempo stimato' : 'Estimated time' }}: <strong>{{ estimatedWaitTime }} {{ currentLang === 'it' ? 'secondi' : 'seconds' }}</strong></p>
              <p class="queue-note">{{ currentLang === 'it' ? 'Elaborazione automatica in corso...' : 'Automatic processing in progress...' }}</p>
              <button class="btn-cancel" (click)="cancelGeneration()">
                âŒ {{ currentLang === 'it' ? 'Cancella' : 'Cancel' }}
              </button>
            </div>
          </div>

          <div *ngIf="isGenerating && generationStatus === 'processing'" class="generating-status">
            <div class="generating-info">
              <div class="spinner-simple"></div>
              <!-- <h3>ğŸ¨ {{ currentLang === 'it' ? 'Creazione contenuto in corso...' : 'Content creation in progress...' }}</h3> -->
              <p>{{ currentLang === 'it' ? 'Stiamo generando il tuo contenuto premium' : 'We are generating your premium content' }}</p>
              <p class="generating-steps">
                <span>{{ currentLang === 'it' ? 'âœ“ Analisi contesto' : 'âœ“ Context analysis' }}</span><br>
                <span>{{ currentLang === 'it' ? 'âœ“ Generazione approcci' : 'âœ“ Approach generation' }}</span><br>
                <span>{{ currentLang === 'it' ? 'â†» Ottimizzazione finale' : 'â†» Final optimization' }}</span>
              </p>
            </div>
          </div>

      
          <div *ngIf="output" class="output-cards">
            <div class="card" 
                 *ngFor="let key of outputKeys" 
                 (click)="openModal(key)">
           <div class="card-header">
      <h4>{{ translationService.translate(key) }}</h4>
      <div class="card-actions">
        <!-- <button class="btn-optimize" 
                (click)="optimizeContent(getOutputValue(key)[0], key); $event.stopPropagation()">
          ğŸš€ Ottimizza con Assistant
        </button> -->
    </div>
    </div>
              <p>{{ getOutputValue(key).join(', ') }}</p>
              <div class="view-more">{{ translationService.translate('viewResults') }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

   
    <div class="modal brand-modal" *ngIf="brandModalOpen" (click)="closeBrandModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeBrandModal()">Ã—</button>
        <h2>{{ currentLang === 'it' ? 'ğŸª Brand & Clienti' : 'ğŸª Brands & Clients' }}</h2>
        
        <div class="brand-limit-header">
          <span class="limit-text">
            {{ currentLang === 'it' ? 'Brand creati:' : 'Brands created:' }} {{ currentBrands }}/{{ maxBrands }}
          </span>
          <div class="limit-bar">
            <div class="limit-fill" [style.width.%]="(currentBrands / maxBrands) * 100"></div>
          </div>
        </div>
        
     
        <div class="brand-list">
          <div *ngFor="let brand of brandProfiles" 
               class="brand-item"
               [class.selected]="selectedBrand?.id === brand.id"
               (click)="toggleBrandSelection(brand)">
            
            <div class="brand-checkbox">
              <div class="checkmark" *ngIf="selectedBrand?.id === brand.id">âœ“</div>
            </div>
            
            <div class="brand-info">
              <h3>{{ brand.brandName }}</h3>
              <p class="brand-tone">{{ brand.tone }}</p>
              <p class="brand-description">{{ brand.brandDescription }}</p>
              <div class="brand-tags">
                <span *ngFor="let tag of brand.defaultHashtags.slice(0, 3)" 
                      class="tag">{{ tag }}</span>
              </div>
            </div>
            
            <div class="brand-actions">
              <button class="btn-edit" (click)="openBrandFormModal(brand); $event.stopPropagation()">
                {{ currentLang === 'it' ? 'Modifica' : 'Edit' }}
              </button>
              <button class="btn-delete" (click)="deleteBrand(brand); $event.stopPropagation()">
                {{ currentLang === 'it' ? 'Elimina' : 'Delete' }}
              </button>
            </div>
          </div>
          
          <div *ngIf="brandProfiles.length === 0" class="no-brands">
            <p>{{ currentLang === 'it' ? 'Nessun brand creato ancora' : 'No brands created yet' }}</p>
            <button class="btn-primary" (click)="openBrandFormModal()">
              {{ currentLang === 'it' ? '+ Crea il tuo primo brand' : '+ Create your first brand' }}
            </button>
          </div>
        </div>
        
      
        <div class="modal-actions">
          <button class="btn-outline" (click)="openBrandFormModal()" [disabled]="!canCreateMoreBrands">
            {{ currentLang === 'it' ? 'Crea Manualmente' : 'Create Manually' }}
          </button>
           <button class="btn-primary" (click)="openWebsiteAnalysisModal()">
    ğŸŒ {{ currentLang === 'it' ? 'Analizza Sito Web' : 'Analyze Website' }}
  </button>
        <button class="btn-confirm" 
          (click)="confirmBrandSelection()"
          [disabled]="!selectedBrand">
    âœ… {{ currentLang === 'it' ? 'Conferma Selezione' : 'Confirm Selection' }}
  </button>
        </div>
      </div>
    </div>

 
    <div class="modal brand-form-modal" *ngIf="brandFormModalOpen" (click)="closeBrandModal()">
      <div class="modal-content large" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeBrandModal()">Ã—</button>
        <h2>{{ editingBrand ? 
          (currentLang === 'it' ? 'Modifica Brand' : 'Edit Brand') : 
          (currentLang === 'it' ? 'Crea Nuovo Brand' : 'Create New Brand') }}</h2>
        
        <div class="brand-creation-tips">
          <h4>{{ currentLang === 'it' ? 'ğŸ’¡ Suggerimenti per un Brand Memory efficace:' : 'ğŸ’¡ Tips for an effective Brand Memory:' }}</h4>
          <ul>
            <li>{{ currentLang === 'it' ? 
              'PiÃ¹ dettagli fornisci, piÃ¹ i contenuti saranno personalizzati' : 
              'The more details you provide, the more personalized the content will be' }}</li>
            <li>{{ currentLang === 'it' ? 
              'Usa esempi reali dal tuo business attuale' : 
              'Use real examples from your current business' }}</li>
            <li>{{ currentLang === 'it' ? 
              'Pensa al linguaggio che usi con i tuoi clienti ideali' : 
              'Think about the language you use with your ideal customers' }}</li>
          </ul>
        </div>
    
        <form class="brand-form">
       
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Nome Brand *' : 'Brand Name *' }}</label>
            <input type="text" [(ngModel)]="newBrand.brandName" name="brandName" 
                   [placeholder]="currentLang === 'it' ? 'Es: TechInnovate, FashionGuru, GreenLife...' : 'Ex: TechInnovate, FashionGuru, GreenLife...'" required>
            <small>{{ currentLang === 'it' ? 
              'Il nome del tuo brand, azienda o progetto' : 
              'Your brand, company or project name' }}</small>
          </div>

        
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Posizionamento di mercato' : 'Market positioning' }}</label>
            <input type="text" [(ngModel)]="newBrand.positioning" name="positioning" 
                   [placeholder]="currentLang === 'it' ? 'Es: Leader innovativo nel settore tech, Marca accessibile per giovani professionisti, Eccellenza artigianale italiana...' : 'Ex: Innovative leader in tech industry, Affordable brand for young professionals, Italian artisan excellence...'">
            <small>{{ currentLang === 'it' ? 
              'Come vuoi che il brand sia percepito nel mercato' : 
              'How you want the brand to be perceived in the market' }}</small>
          </div>

          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Tono di Voce' : 'Voice Tone' }}</label>
            <select [(ngModel)]="newBrand.tone" name="tone">
              <option *ngFor="let tone of getToneOptions()" [value]="tone.value">
                 {{ tone.label }}
              </option>
            </select>
            <small>{{ currentLang === 'it' ? 
              'Il linguaggio che useremo per i tuoi contenuti' : 
              'The language we will use for your content' }}</small>
          </div>

          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Descrizione brand' : 'Brand description' }}</label>
            <textarea [(ngModel)]="newBrand.brandDescription" name="brandDescription" rows="3" 
                      [placeholder]="currentLang === 'it' ? 'Descrivi la tua attivitÃ , mission e valori... Es: Siamo un brand di moda sostenibile che crea abiti eco-friendly per persone moderne che cercano stile e consapevolezza ambientale' : 'Describe your business, mission and values... Ex: We are a sustainable fashion brand creating eco-friendly clothes for modern people seeking style and environmental awareness'"></textarea>
            <small>{{ currentLang === 'it' ? 
              'Chi sei e cosa fai? Questa descrizione aiuta l AI a capire il tuo business' : 
              'Who you are and what you do. This description helps AI understand your business' }}</small>
          </div>

         
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Pubblico di Riferimento' : 'Target Audience' }}</label>
            <input type="text" [(ngModel)]="newBrand.targetAudience" name="targetAudience"
                   [placeholder]="currentLang === 'it' ? 'Es: Donne 25-40 anni professioniste, Giovani startup founder, Famiglie con bambini piccoli...' : 'Ex: Professional women 25-40 years old, Young startup founders, Families with young children...'">
            <small>{{ currentLang === 'it' ? 
              'A chi ti rivolgi principalmente?' : 
              'Who is your primary target audience?' }}</small>
          </div>

         
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Valori del brand' : 'Brand values' }}</label>
            <input type="text" [(ngModel)]="newBrand.brandValues" name="brandValues"
                   [placeholder]="currentLang === 'it' ? 'Es: Innovazione, SostenibilitÃ , QualitÃ , Trasparenza, Community...' : 'Ex: Innovation, Sustainability, Quality, Transparency, Community...'">
            <small>{{ currentLang === 'it' ? 
              'I valori fondamentali del tuo brand' : 
              'The core values of your brand' }}</small>
          </div>

         
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Slogan/Tagline' : 'Tagline' }}</label>
            <input type="text" [(ngModel)]="newBrand.tagline" name="tagline"
                   [placeholder]="currentLang === 'it' ? 'Es: Innovazione che ispira, La moda che rispetta il pianeta, SemplicitÃ  Ã¨ genio...' : 'Ex: Inspiring innovation, Fashion that respects the planet, Simplicity is genius...'">
            <small>{{ currentLang === 'it' ? 
              'Il tuo slogan o frase distintiva' : 
              'Your slogan or distinctive phrase' }}</small>
          </div>

        
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Call-to-Action Preferite' : 'Preferred Call-to-Actions' }}</label>
            <div class="input-with-btn">
              <input type="text" [(ngModel)]="tempCTA" name="tempCTA" 
                     [placeholder]="currentLang === 'it' ? 'Es: Prenota una demo, Scopri di piÃ¹, Acquista ora...' : 'Ex: Book a demo, Learn more, Buy now...'" (keyup.enter)="addCTA()">
              <button type="button" (click)="addCTA()">+</button>
            </div>
            <div class="tags-list">
              <span *ngFor="let cta of newBrand.preferredCTAs; let i = index" class="tag cta">
                {{ cta }} <span class="remove-tag" (click)="removeCTA(i)">Ã—</span>
              </span>
            </div>
            <small>{{ currentLang === 'it' ? 
              'Frasi di invito ad agire che usi tipicamente' : 
              'Action phrases you typically use to encourage engagement' }}</small>
          </div>

        
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Parole Chiave Preferite' : 'Preferred Keywords' }}</label>
            <div class="input-with-btn">
              <input type="text" [(ngModel)]="tempKeyword" name="tempKeyword" 
                     [placeholder]="currentLang === 'it' ? 'Es: innovazione, design, sostenibilitÃ , qualitÃ , community...' : 'Ex: innovation, design, sustainability, quality, community...'" (keyup.enter)="addKeyword()">
              <button type="button" (click)="addKeyword()">+</button>
            </div>
            <div class="tags-list">
              <span *ngFor="let keyword of newBrand.preferredKeywords; let i = index" class="tag">
                {{ keyword }} <span class="remove-tag" (click)="removeKeyword(i)">Ã—</span>
              </span>
            </div>
            <small>{{ currentLang === 'it' ? 
              'Termini che vuoi vengano usati frequentemente nei tuoi contenuti' : 
              'Terms you want to be used frequently in your content' }}</small>
          </div>

        
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Parole da evitare' : 'Words to Avoid' }}</label>
            <div class="input-with-btn">
              <input type="text" [(ngModel)]="tempAvoidedWord" name="tempAvoidedWord" 
                     [placeholder]="currentLang === 'it' ? 'Es: costoso, complicato, vecchio, noioso, difficile...' : 'Ex: expensive, complicated, old, boring, difficult...'" (keyup.enter)="addAvoidedWord()">
              <button type="button" (click)="addAvoidedWord()">+</button>
            </div>
            <div class="tags-list">
              <span *ngFor="let word of newBrand.avoidedWords; let i = index" class="tag avoided">
                {{ word }} <span class="remove-tag" (click)="removeAvoidedWord(i)">Ã—</span>
              </span>
            </div>
            <small>{{ currentLang === 'it' ? 
              'Termini che NON vuoi vengano usati nei tuoi contenuti' : 
              'Terms you do NOT want to be used in your content' }}</small>
          </div>

        
          <div class="form-group">
            <label>{{ currentLang === 'it' ? 'Hashtag Predefiniti' : 'Default Hashtags' }}</label>
            <div class="input-with-btn">
              <input type="text" [(ngModel)]="tempHashtag" name="tempHashtag" 
                     [placeholder]="currentLang === 'it' ? 'Aggiungi hashtag' : 'Add hashtag'" (keyup.enter)="addHashtag()">
              <button type="button" (click)="addHashtag()">+</button>
            </div>
            <div class="tags-list">
              <span *ngFor="let hashtag of newBrand.defaultHashtags; let i = index" class="tag hashtag">
                {{ hashtag }} <span class="remove-tag" (click)="removeHashtag(i)">Ã—</span>
              </span>
            </div>
            <small>{{ currentLang === 'it' ? 
              'Hashtag che verranno aggiunti ai tuoi post' : 
              'Hashtags that will be added to your posts' }}</small>
          </div>

        
          <div class="form-actions">
            <button type="button" class="btn-outline" (click)="closeBrandModal()">
              {{ currentLang === 'it' ? 'Annulla' : 'Cancel' }}
            </button>
            <button type="button" class="btn-primary" (click)="saveBrand()">
              {{ editingBrand ? (currentLang === 'it' ? 'Aggiorna Brand' : 'Update Brand') : (currentLang === 'it' ? 'Crea Brand' : 'Create Brand') }}
            </button>
          </div>
        </form>
      </div>
    </div>

  
    <div class="modal" *ngIf="modalOpen" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn large-close-btn" (click)="closeModal()" [title]="currentLang === 'it' ? 'Chiudi' : 'Close'">Ã—</button>
        <div class="modal-header">
          <h2>{{ formatTitle(selectedKey) }}</h2>
          <button class="close-btn" (click)="closeModal()">Ã—</button>
        </div>
         <!-- <div class="optimization-explanation"> 
      <h4>ğŸ’¡ {{ currentLang === 'it' ? 'Come funziona l\'ottimizzazione:' : 'How optimization works:' }}</h4>
      <ol>
        <li><strong>{{ currentLang === 'it' ? 'Genera' : 'Generate' }}</strong> {{ currentLang === 'it' ? 'contenuto qui nel generator' : 'content in the generator' }}</li>
        <li><strong>{{ currentLang === 'it' ? 'Vedi i risultati' : 'See results' }}</strong> {{ currentLang === 'it' ? 'in questo modal' : 'in this modal' }}</li>
        <li><strong>{{ currentLang === 'it' ? 'Ottimizza' : 'Optimize' }}</strong> {{ currentLang === 'it' ? 'i migliori risultati con l\'Assistant' : 'the best results with the Assistant' }}</li>
       <li><strong>{{ currentLang === 'it' ? 'Copia' : 'Copy' }}</strong> {{ currentLang === 'it' ? 'la versione finale ottimizzata' : 'the final optimized version' }}</li> 
      </ol>
    </div> -->
        <div class="versions-container">
          <div class="versions">
            <div class="version" [attr.data-version]="i+1" *ngFor="let v of selectedVersions; let i = index">
             <div class="version-header">
        <span class="version-number">Versione {{ i + 1 }}</span>
        <div class="version-actions">
          <button class="copy-btn" 
                  (click)="copyToClipboard(v, $event, i)"
                  [class.copied]="copiedIndex === i">
            {{ copiedIndex === i ? translationService.translate('copied') : translationService.translate('copy') }}
          </button>
          <button class="save-btn" 
                  (click)="savePost(v, selectedKey)"
                  [title]="currentLang === 'it' ? 'Salva nell\'archivio' : 'Save to archive'">
            {{ translationService.translate('save') }}
          </button>
          <button class="optimize-btn" 
                  (click)="openContentAssistant(v)">
            ğŸš€ {{ translationService.translate('Ottimizza con assistente AI') }}
          </button>
        </div>
      </div>
           <div class="version-content">
        <p>{{ v }}</p>
            </div>
          </div>
        </div>
      </div>
    

  <div *ngIf="creditStoreModalOpen" class="modal-overlay" (click)="closeCreditStore()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ currentLang === 'it' ? 'Acquista Credit' : 'Buy Credits' }}</h2>
        <button class="close-btn" (click)="closeCreditStore()">Ã—</button>
      </div>
      <div class="modal-body">
        <app-credit-store></app-credit-store>
      </div>
    </div>
  </div>
</div>


<div class="modal website-analysis-modal" *ngIf="websiteAnalysisModalOpen" (click)="websiteAnalysisModalOpen = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="websiteAnalysisModalOpen = false">Ã—</button>
    
    <h2>ğŸŒ {{ currentLang === 'it' ? 'Analizza Sito Web' : 'Analyze Website' }}</h2>
    
    <div class="analysis-description">
      <p>{{ currentLang === 'it' ? 
        'Incolla l\'URL del tuo sito web e creeremo automaticamente un profilo brand:' : 
        'Paste your website URL and we will automatically create a brand profile:' }}</p>
    </div>

    <div class="website-input-section">
      <label for="websiteUrl">ğŸŒ {{ currentLang === 'it' ? 'URL del sito web' : 'Website URL' }}</label>
      <input 
        type="url" 
        id="websiteUrl"
        [(ngModel)]="websiteUrl" 
        placeholder="https://ilmiosito.it"
        [disabled]="analyzingWebsite">
    </div>

    <div class="modal-actions">
      <button 
        class="btn-outline" 
        (click)="websiteAnalysisModalOpen = false"
        [disabled]="analyzingWebsite">
        {{ currentLang === 'it' ? 'Annulla' : 'Cancel' }}
      </button>
      
      <button 
        class="btn-primary" 
        (click)="analyzeWebsite()"
        [disabled]="!websiteUrl || analyzingWebsite">
        
        <span *ngIf="!analyzingWebsite">
          ğŸš€ {{ currentLang === 'it' ? 'Analizza e Crea Brand' : 'Analyze and Create Brand' }}
        </span>
        
        <span *ngIf="analyzingWebsite" class="analyzing-state">
          <div class="spinner-small"></div>
          {{ currentLang === 'it' ? 'Analisi in corso...' : 'Analyzing...' }}
        </span>
      </button>
    </div>
  </div>
</div>

<div class="modal large" *ngIf="assistantModalOpen" (click)="closeContentAssistant()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeContentAssistant()">Ã—</button>
    
    <app-content-assistant-component
      [selectedBrand]="selectedBrand"
      [selectedPlatform]="platform"
      (suggestionApplied)="onSuggestionApplied($event)">
    </app-content-assistant-component>
  </div>
</div> 